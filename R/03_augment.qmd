---
title: "Adding new variables"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

# Loading packages

```{r}

library("tidyverse")

source(file = "R/99_proj_func.R")
```

# Loading data files

```{r}

data_clean <- read_csv(file = "data/data_clean.csv")

PCA_clean <- read_csv(file = "data/PCA_clean.csv")
```

# Add variables

```{r}

level_3 <- c("Tgd", 
             "TCD8", 
             "TCD4", 
             "Bnaive", 
             "BnatEff", 
             "BIgM", 
             "BswMem",
             "Bdn", 
             "B27high", 
             "BnaiveTo", 
             "CC", 
             "CB", 
             "UnswtMem", 
             "SwtMem", 
             "PC")

data_aug <- data_clean |>
  filter(CD != "FMO") |>
  mutate(hierarchy_level = case_when(cell_type == "Lymphs" ~ 1,
                                     cell_type %in% c("T", "B") ~ 2,
                                     cell_type %in% level_3 ~ 3,
                                     .default = 4),
         .after = cell_type) |>
  mutate(lineage = case_when(tissue == "thymus" ~ "thymocytes",
                             str_detect(cell_type, "CD4") ~ "CD4 T cells",
                             str_detect(cell_type, "CD8") ~ "CD8 T cells",
                             str_starts(cell_type, "T") ~ "T cells",
                             .default = "B cells"),
         .before = cell_type)
```

```{r}

PCA_aug <- PCA_clean |>
  mutate(lineage = case_when(tissue == "thymus" ~ "thymocytes",
                             str_detect(cell_type, "CD4") ~ "CD4 T cells",
                             str_detect(cell_type, "CD8") ~ "CD8 T cells",
                             str_starts(cell_type, "T") ~ "T cells",
                             .default = "B cells"),
         .before = cell_type)
```

# Writing data files

```{r}

write_csv(x = data_aug,
          file = "data/data_aug.csv")

write_csv(x = PCA_aug,
          file = "data/PCA_aug.csv")
```
