---
title: "05_PCA"
format: html
---

# Loading libraries

```{r}
library(broom)
```

# Filling PCA_nested data set with median in empty cells

```{r}
PCA_filled <- PCA_nested |>
  mutate(across(
    where(is.numeric),
    ~ if_else(is.na(.x), median(.x, na.rm = TRUE), .x)
  ))
```

# Make the PCA set

```{r}
pca_data <- PCA_filled|> 
  select(where(is.numeric)) |>
  prcomp(scale = TRUE)

```

# Make the plott

```{r}
pca_data |> 
  augment(data = PCA_filled) |>
  ggplot(aes(.fittedPC1, 
             .fittedPC2,
             shape = tissue,
             color = lineage)) +
  geom_point(size = 1.5,
             alpha = 0.4) +
  labs(title = "PCA plot",
       x = "PC1",
       y = "PC2",
       color = "cell lineage") +
  theme_bw()+
    theme(
      legend.key.size = unit(0.4, "lines"),   #height of each legend row
      legend.text = element_text(size = 7),   #smaller text
      legend.spacing.y = unit(0.1, "lines"),  #vertical space between rows
      legend.spacing.x = unit(0.2, "lines")   #horizontal spacing
  ) 
```

# Text

### Populating all cells in dataset

When you make a PCA plot you need all numeric rows and columns to be filled with data. So firstly we needed to fill the empty cells with data. These were empty due to the different cell types and CD's. Unpopulated cells was populated with the median for the column. We avoided using the mean due to outliers potentially skewing the data.

### PCA

After all numeric cells were populated the function `prcomp` was used to make the the PCA.

### Plot

On the plot we have PC1 on the x-axis and PC2 on the y-axis. Usually most variation can be captured with the first two principal components. The points are stratified using tissue type (blood, tonsil, thymus) as the shapes and
