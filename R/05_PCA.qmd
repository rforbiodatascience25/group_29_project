---
title: "05_PCA"
format: html
editor_options: 
  chunk_output_type: console
---

# Loading libraries

```{r}

library("tidyverse")
library("broom")

```

# Loading data files

```{r}

PCA_aug <- read_csv(file = "data/PCA_aug.csv")

```

# Make the PCA set

```{r}

PCA_data <- PCA_aug |> 
  select(where(is.numeric)) |>
  prcomp(scale = TRUE)

```

# Make the plott

```{r}

PCA_data |> 
  augment(data = PCA_aug) |>
  ggplot(aes(.fittedPC1, 
             .fittedPC2,
             shape = tissue,
             color = lineage)) +
  geom_point(size = 1.5,
             alpha = 0.4) +
  labs(title = "PCA plot",
       x = "PC1",
       y = "PC2",
       color = "cell lineage") +
  theme_bw()+
    theme(
      legend.key.size = unit(0.4, "lines"),
      legend.text = element_text(size = 7),
      legend.spacing.y = unit(0.1, "lines"),
      legend.spacing.x = unit(0.2, "lines")
  )

```

# Text

### Populating all cells in dataset

When you make a PCA plot you need all numeric rows and columns to be filled with data. So firstly we needed to fill the empty cells with data. These were empty due to the different cell types and CD's. Unpopulated cells was populated with the median for the column. We avoided using the mean due to outliers potentially skewing the data.

### PCA

After all numeric cells were populated the function `prcomp` was used to make the the PCA.

### Plot

On the plot we have PC1 on the x-axis and PC2 on the y-axis. Usually most variation can be captured with the first two principal components. The points are stratified using tissue type (blood, tonsil, thymus) as the shapes and cell lineage as the color.

### Plot interpretation

As we can see on the plot we have some nice clustering. We see all the cells from thymus clustered nicely and tonsil points are also somewhat clustered. In the blood we see two different clusters, with one containing all blood B cells except for one, and the other one containing the rest of the cell lineages. We can also see that the B cell lineage from blood and thymus didn't vary much in PC1 but PC2 set them apart.
